# `thiserror`

少し回り道でしたね。しかし、必要なものでした！  
今度は軌道に戻りましょう：カスタムエラー型と`thiserror`です。

## カスタムエラー型

カスタムエラー型に「手動で」`Error`トレイトを実装する方法を見てきました。  
コードベースの大部分のエラー型でこれを行わなければならないとします。それは多くのボイラープレートではないでしょうか？

[`thiserror`](https://docs.rs/thiserror/latest/thiserror/)というRustクレートを使用することで、ボイラープレートの一部を削除できます。これは、カスタムエラー型の作成を簡素化する**手続きマクロ**を提供します。

```rust
#[derive(thiserror::Error, Debug)]
enum TicketNewError {
    #[error("{0}")]
    TitleError(String),
    #[error("{0}")]
    DescriptionError(String),
}
```

## 独自のマクロを書くことができます

これまで見てきた`derive`マクロはすべて、Rust標準ライブラリによって提供されていました。  
`thiserror::Error`は**サードパーティ**の`derive`マクロの最初の例です。

`derive`マクロは**手続きマクロ**のサブセットで、コンパイル時にRustコードを生成する方法です。  
このコースでは手続きマクロの書き方の詳細には入りませんが、独自のものを書けることを知っておくことが重要です！  
より高度なRustコースで取り組むべきトピックです。

## カスタム構文

各手続きマクロは独自の構文を定義でき、通常はクレートのドキュメントで説明されています。  
`thiserror`の場合、次のものがあります：

- `#[derive(thiserror::Error)]`：これは、`thiserror`の助けを借りて、カスタムエラー型に`Error`トレイトを導出する構文です。
- `#[error("{0}")]`：これは、カスタムエラー型の各バリアントに`Display`実装を定義する構文です。  
  エラーが表示されるとき、`{0}`はバリアントの0番目のフィールド（この場合は`String`）に置き換えられます。